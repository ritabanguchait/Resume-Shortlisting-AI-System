<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Candidate Results - ResumeAI</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="js/theme.js"></script>
    <script src="js/app.js" defer></script>
    <script src="js/results-ats.js" defer></script>
</head>
<body style="background: var(--gray-50);">
    <div id="app">
        <!-- Navigation -->
        <nav class="navbar" style="background: white; box-shadow: var(--shadow-sm);">
            <div class="navbar-content">
                <a href="#" onclick="App.loadPage('dashboard-hr.html'); return false;" class="brand">
                    <span>‚ö°</span> ResumeAI
                    <span class="badge badge-primary ml-2" style="font-size: 0.625rem;">ENTERPRISE</span>
                </a>
                <button onclick="App.loadPage('dashboard-hr.html')" class="btn btn-ghost btn-sm">
                    <span>‚Üê</span> Dashboard
                </button>
                <button id="themeToggle" class="btn btn-ghost btn-icon" title="Toggle theme" style="padding: 0.5rem; width: 40px; height: 40px;">
                    <span class="theme-icon-light" style="font-size: 1.25rem;">üåô</span>
                    <span class="theme-icon-dark" style="display: none; font-size: 1.25rem;">‚òÄÔ∏è</span>
                </button>
            </div>
        </nav>

        <!-- Header Section -->
        <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); color: white; padding: 3rem 0;">
            <div class="container">
                <div class="flex justify-between items-center flex-wrap gap-4">
                    <div>
                        <h1 style="font-size: 2rem; color: white; margin-bottom: 0.5rem;">Candidate Rankings</h1>
                        <p style="opacity: 0.9; font-size: 1.125rem;">AI-powered shortlist based on semantic matching</p>
                    </div>
                    <div class="flex gap-3">
                        <button class="btn btn-secondary" onclick="exportResults('csv')" style="background: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.2); color: white;">
                            <span>üì•</span> Export CSV
                        </button>
                        <button class="btn btn-primary" onclick="window.print()">
                            <span>üñ®Ô∏è</span> Print Report
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="container section">
            <!-- Stats Overview -->
            <div id="statsContainer" class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <!-- Stats injected by JS -->
                <div class="stat-card">
                    <div class="stat-label">Total Candidates</div>
                    <div class="stat-value" id="totalCount">0</div>
                </div>
                <div class="stat-card" style="border-left-color: var(--success);">
                    <div class="stat-label">Shortlisted</div>
                    <div class="stat-value" style="color: var(--success);" id="shortlistedCount">0</div>
                </div>
                <div class="stat-card" style="border-left-color: var(--warning);">
                    <div class="stat-label">Under Review</div>
                    <div class="stat-value" style="color: var(--warning);" id="reviewCount">0</div>
                </div>
                <div class="stat-card" style="border-left-color: var(--info);">
                    <div class="stat-label">Avg. Match Score</div>
                    <div class="stat-value" style="color: var(--info);" id="avgScore">--</div>
                </div>
            </div>

            <!-- Filters & Search -->
            <div class="card mb-6">
                <div class="flex gap-4 flex-wrap items-end">
                    <div class="flex-1" style="min-width: 250px;">
                        <label class="form-label">Search Candidates</label>
                        <input 
                            type="text" 
                            id="searchInput" 
                            class="form-input" 
                            placeholder="Search by name, skills, or experience..."
                        >
                    </div>
                    <div style="min-width: 180px;">
                        <label class="form-label">Status Filter</label>
                        <select id="statusFilter" class="form-select">
                            <option value="all">All Statuses</option>
                            <option value="Shortlisted">Shortlisted</option>
                            <option value="Under Review">Under Review</option>
                            <option value="Rejected">Rejected</option>
                        </select>
                    </div>
                    <div style="min-width: 180px;">
                        <label class="form-label">Sort By</label>
                        <select id="sortSelect" class="form-select">
                            <option value="score-desc">Highest Score First</option>
                            <option value="score-asc">Lowest Score First</option>
                            <option value="experience-desc">Most Experienced</option>
                            <option value="name-asc">Name (A-Z)</option>
                        </select>
                    </div>
                    <button class="btn btn-secondary" onclick="resetFilters()">
                        Reset
                    </button>
                </div>
            </div>

            <!-- Bulk Actions -->
            <div class="card mb-6" style="background: var(--primary-light); border: 1px solid var(--primary-light);">
                <div class="flex justify-between items-center flex-wrap gap-4">
                    <div class="flex items-center gap-3">
                        <input type="checkbox" id="selectAll" style="width: 18px; height: 18px; cursor: pointer;">
                        <span class="font-semibold">
                            <span id="selectedCount">0</span> candidates selected
                        </span>
                    </div>
                    <div class="flex gap-2">
                        <button class="btn btn-sm btn-primary" onclick="bulkAction('shortlist')" disabled id="bulkShortlistBtn">
                            <span>‚≠ê</span> Shortlist
                        </button>
                        <button class="btn btn-sm btn-secondary" onclick="bulkAction('review')" disabled id="bulkReviewBtn">
                            <span>üëÅÔ∏è</span> Review
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="bulkAction('reject')" disabled id="bulkRejectBtn">
                            <span>‚úï</span> Reject
                        </button>
                    </div>
                </div>
            </div>

            <!-- Results Table -->
            <div class="card">
                <div id="resultsContainer">
                    <!-- Loading State -->
                    <div id="loadingState" class="text-center p-8">
                        <div class="spinner mx-auto mb-4"></div>
                        <p class="text-muted">Loading candidate data...</p>
                    </div>

                    <!-- Empty State -->
                    <div id="emptyState" class="text-center p-8" style="display: none;">
                        <div style="font-size: 4rem; opacity: 0.3; margin-bottom: 1rem;">üë•</div>
                        <h3 class="text-xl font-semibold mb-2">No Candidates Found</h3>
                        <p class="text-secondary mb-4">Upload resumes to start analyzing candidates</p>
                        <button onclick="App.loadPage('upload.html')" class="btn btn-primary">
                            Upload Resumes
                        </button>
                    </div>

                    <!-- Data Table -->
                    <div id="resultsTable" style="display: none;">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th style="width: 40px;">
                                            <input type="checkbox" class="select-all-checkbox" style="width: 16px; height: 16px; cursor: pointer;">
                                        </th>
                                        <th>Candidate</th>
                                        <th>Match Score</th>
                                        <th>Experience</th>
                                        <th>Key Skills</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="candidatesTableBody">
                                    <!-- Populated by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- No Results (after filtering) -->
                    <div id="noResults" class="text-center p-8" style="display: none;">
                        <div style="font-size: 3rem; opacity: 0.3; margin-bottom: 1rem;">üîç</div>
                        <h3 class="text-lg font-semibold mb-2">No matches found</h3>
                        <p class="text-secondary">Try adjusting your search or filter criteria</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .candidate-row {
            transition: all 0.2s;
        }
        
        .candidate-row:hover {
            background: var(--gray-50);
        }
        
        .candidate-row.selected {
            background: var(--primary-light);
        }
        
        .score-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-weight: 700;
            font-size: 1.125rem;
        }
        
        .score-high {
            background: var(--success-light);
            color: var(--success);
        }
        
        .score-medium {
            background: var(--warning-light);
            color: var(--warning);
        }
        
        .score-low {
            background: var(--danger-light);
            color: var(--danger);
        }
        
        .skill-tag {
            display: inline-block;
            padding: 0.25rem 0.625rem;
            background: var(--gray-100);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            margin-right: 0.25rem;
            margin-bottom: 0.25rem;
        }
    </style>

    <script>
        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('statusFilter').value = 'all';
            document.getElementById('sortSelect').value = 'score-desc';
            // Trigger re-render
            if (window.renderResults) window.renderResults();
        }
        
        function exportResults(format) {
            alert(`Exporting results as ${format.toUpperCase()}... (Feature coming soon)`);
        }
        
        function bulkAction(action) {
            const selected = document.querySelectorAll('.candidate-checkbox:checked').length;
            if (selected === 0) {
                alert('Please select at least one candidate');
                return;
            }
            alert(`${action} action for ${selected} candidate(s) - Feature coming soon`);
        }
        
        // Selection handling
        document.addEventListener('DOMContentLoaded', () => {
            const selectAllCheckbox = document.getElementById('selectAll');
            const selectedCountSpan = document.getElementById('selectedCount');
            const bulkButtons = [
                document.getElementById('bulkShortlistBtn'),
                document.getElementById('bulkReviewBtn'),
                document.getElementById('bulkRejectBtn')
            ];
            
            function updateBulkActions() {
                const checkboxes = document.querySelectorAll('.candidate-checkbox');
                const checked = document.querySelectorAll('.candidate-checkbox:checked');
                
                selectedCountSpan.textContent = checked.length;
                
                bulkButtons.forEach(btn => {
                    btn.disabled = checked.length === 0;
                });
                
                if (selectAllCheckbox) {
                    selectAllCheckbox.checked = checkboxes.length > 0 && checked.length === checkboxes.length;
                }
            }
            
            if (selectAllCheckbox) {
                selectAllCheckbox.addEventListener('change', (e) => {
                    const checkboxes = document.querySelectorAll('.candidate-checkbox');
                    checkboxes.forEach(cb => cb.checked = e.target.checked);
                    updateBulkActions();
                });
            }
            
            // Delegate event for dynamically added checkboxes
            document.addEventListener('change', (e) => {
                if (e.target.classList.contains('candidate-checkbox')) {
                    updateBulkActions();
                }
            });
        });
    </script>
</body>
</html>
